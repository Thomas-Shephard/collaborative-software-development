name: Build and Test

on:
    push:
        branches: [ main ]
    pull_request:
        branches: [ main ]

env:
    DOTNET_VERSION: '10.0'

jobs:
    build-wpf-app:
        name: Build WPF App
        runs-on: windows-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v6
            -   name: Setup .NET ${{ env.DOTNET_VERSION }}
                uses: actions/setup-dotnet@v5
                with:
                    dotnet-version: ${{ env.DOTNET_VERSION }}
            -   name: Build
                run: dotnet build src/Jahoot.Display/Jahoot.Display.csproj --configuration Release

    build-and-test-web-api:
        name: Build and Test Web API
        runs-on: ubuntu-latest
        steps:
            -   name: Checkout
                uses: actions/checkout@v6
            -   name: Setup .NET ${{ env.DOTNET_VERSION }}
                uses: actions/setup-dotnet@v5
                with:
                    dotnet-version: ${{ env.DOTNET_VERSION }}
            -   name: Test
                run: dotnet test backend.slnx --configuration Release --collect:"XPlat Code Coverage" --results-directory ./coverage --settings coverlet.runsettings
            -   name: Install Coverage Checker
                run: dotnet tool install --global CoverageChecker.CommandLine
            -   name: Check Coverage
                run: coveragechecker --format Cobertura --glob-patterns 'coverage/**/coverage.cobertura.xml' --line-threshold 100 --branch-threshold 100
            -   name: Set up Docker Buildx
                uses: docker/setup-buildx-action@e468171a9de216ec08956ac3ada2f0791b6bd435
            -   name: Build Docker Image
                uses: docker/build-push-action@263435318d21b8e681c14492fe198d362a7d2c83
                with:
                    file: ./src/Jahoot.WebApi/Dockerfile
                    push: false
